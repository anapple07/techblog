<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<base href="http://example.org/">
<meta name="author" content="Anna">

<meta name="generator" content="Hugo 0.62.2" />
<title>Mapっぽいなにか</title>
<link rel="shortcut icon" href="http://example.org/images/favicon.ico" type="">
<link rel="stylesheet" href="http://example.org/css/style.css">
<link rel="stylesheet" href="http://example.org/css/highlight.css">

  



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">


<link href="http://example.org/index.xml" rel="alternate" type="application/rss+xml" title="tech.anapple07" />



  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@anapple07_jp">
  <meta name="twitter:creator" content="@anapple07_jp">


<meta property="og:title" content="Mapっぽいなにか">
<meta property="og:type" content="website">
<meta property="og:url" content="http://example.org/">





<link rel="canonical" href="http://example.org/post/2020/01/11/">

    </head>
<body>
	  <header class="header">
			<img src="" alt="">

		</header>
    <nav class="main-nav">
        <ul>
    <li class="active"><a href='http://example.org/'>Articles</a></li>
    <li><a href='http://example.org/about'>About</a></li>
    
</ul>

    </nav>
    
    
    
    <div id="site-wrapper">
        <main>
            
  <article class="single">
    <h1>Mapっぽいなにか</h1>
    <section class="extras">
        <span class="tags">
          <small class="time">January 11, 2020</small>
          
             , tags
             
                <a href="http://example.org/tags/perl">Perl</a>
             
          
        </span>
    </section>
    <section class="description">
      
    </section>
    
    <section id="content" class="body">
        <p>先日気になったのでどうなのかなーって思って調べた話。(for Perl)</p>
<p><code>my @array = ( 1..1_000 );</code></p>
<p>この配列の値をハッシュのkeyにして扱いやすくしてあれこれしていく、っていうを割とやるのですが、
だいたい</p>
<pre><code>my %map = map { $_ =&gt; 1 } @array;
</code></pre><p>とか</p>
<pre><code>my %map;
foreach my $id ( @array ) {
    $map{$id} = 1;
}
</code></pre><p>とかってやってたのですが先日</p>
<pre><code>my %map;
@map{@array} = ();
</code></pre><p>outout が 
%map = {
1 =&gt; undef,
2 =&gt; undef,
&hellip;.
}
こう書いた方が速いです、というコメントを見て、こんな書き方できるのかーって思ったのと
本当に速いんですか？って思ったので調べた。</p>
<pre><code>#!/usr/bin/env perl
use strict;
use warnings;
use Time::HiRes qw(gettimeofday tv_interval);
my @array = ( 1..1_000 );
{
    my $t0 = [gettimeofday];
    my %map;
    @map{@array} = ();
    my $elapsed = tv_interval($t0);
    print '--@map{@array}--' . &quot;\n&quot;;
    print $elapsed * 1000 . &quot;\n&quot;;
}
{
    my $t0 = [gettimeofday];
    my %map = map { $_ =&gt; 1 } @array;
    my $elapsed = tv_interval($t0);
    print '--map--' . &quot;\n&quot;;
    print $elapsed * 1000 . &quot;\n&quot;;
}
{
    my $t0 = [gettimeofday];
    my %map;
    foreach my $id ( @array ) {
        $map{$id} = 1;
    }
    my $elapsed = tv_interval($t0);
    print '--foreach--' . &quot;\n&quot;;
    print $elapsed * 1000 . &quot;\n&quot;;
}
{
    my $t0 = [gettimeofday];
    my %map;
    for my $id ( @array ) {
        $map{$id} = 1;
    }
    my $elapsed = tv_interval($t0);
    print '--for--' . &quot;\n&quot;;
    print $elapsed * 1000 . &quot;\n&quot;;
}

1;
</code></pre><p>実行結果</p>
<h3 id="1_000_000で実行">1_000_000で実行</h3>
<pre><code>$perl sample.pl
--@map{@array}--
740.508
--map--
1199.097
--foreach--
639.542
--for--
650.275
</code></pre><h3 id="10_000_000-で実行">10_000_000 で実行</h3>
<pre><code>$perl sample.pl 10_000_000
--@map{@array}--
11308.191
--map--
16796.802
--foreach--
9985.983
--for--
10101.491
</code></pre><p>※ foreachとforが定期的にどっちが速いのかわからなくなるのでまた調べた。
一応
<a href="https://perldoc.perl.org/perlsyn.html">https://perldoc.perl.org/perlsyn.html</a></p>
<blockquote>
<p>The foreach keyword is actually a synonym for the for keyword, so you can use either</p>
</blockquote>
<p>for と foreachはperldocで同義ですよって言われている。
foreachが速いって思ってたんだけどPHPとごっちゃになってるのかな。</p>
<p><a href="https://qiita.com/h13/items/a75fba76f435212a2eb3">https://qiita.com/h13/items/a75fba76f435212a2eb3</a></p>
<p>とにかく</p>
<p><!-- raw HTML omitted -->foreach = for &gt; @map{@array} &gt; map<!-- raw HTML omitted --></p>
<p>の順で速かったので mapより @map{@array}  にしたほうが速かった。</p>
<p>ちなみに
valueがundefになって速いなら</p>
<pre><code>my %map;
foreach my $id ( @array ) {
    $map{$id} = undef;
}
</code></pre><p>にしたら速くなるのでは？と思ったけどそんなことはなかった。</p>
<p>まあけど、可読性がよくなるという理由以外にmap使わないようにしましょうって話ですね。</p>
<p>ワンライナーかっこいいという理由でmap使いがちでした/(^o^)\おわた</p>

    </section> 
    
    
     
  </article>
  
<div class="share-card">
    <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fexample.org%2fpost%2f2020%2f01%2f11%2f - Map%e3%81%a3%e3%81%bd%e3%81%84%e3%81%aa%e3%81%ab%e3%81%8b by @anapple07_jp"><i class="fa fa-twitter"></i> Tweet</a>

    <a class="facebook" href="#" onclick="
        window.open(
          'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
          'facebook-share-dialog',
          'width=626,height=436');
        return false;"><i class="fa fa-facebook"></i> Share
    </a>
</div>


 
  

        </main>
        
        <aside class="desktop-only">
            
	<div class="widgets">
      
  <section itemscope itemtype="https://schema.org/Person" class="widget socials">
    <h2 class="widget-title">Socials</h2>
    <ul>
        
        
        <li><a href="https://twitter.com/anapple07_jp"><i class="fa fa-twitter"></i></a></li>
        
        
        
        <li><a href="https://github.com/anapple07"><i class="fa fa-github"></i></a></li>
        
    </ul>
  </section>

 

</div>


            <footer id="footer">
    <p class="small">
      Copyright © 2020, all rights reserved.
    </p>
</footer>
        </aside>
    </div>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://example.org/js/main.js"></script>
<script src="http://example.org/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>





</body>
</html>
